<?xml version="1.0"?>
<project default="docs" name="docs build file">
  <!-- =================================================================== -->
  <!-- Prepares the docs                                                   -->
  <!-- =================================================================== -->
  <target name="prepare-docs">

    <property name="forrest.cent.dir" value="${cents.dir}/forrest.${cent.dir.suffix}"/> 

    <!-- define filters --> 
    <filter token="skin" value="${forrest.skin.name}"/>
    

    <mkdir dir="${xlayout.build.documentation.dir}"/>
    <mkdir dir="${xlayout.build.work.dir}"/>


    <!-- make filtered copy of XML docs -->
    <copy todir="${xlayout.build.documentation.dir}" filtering="on">
      <fileset dir="${xlayout.source.documentation.dir}" casesensitive="no">
        <include name="**/*.xml"/>
      </fileset>
    </copy>

    <!-- make filtered copy of images -->
    <copy todir="${xlayout.build.documentation.dir}" filtering="off">
      <fileset dir="${xlayout.source.documentation.dir}" casesensitive="no">
        <exclude name="**/*.xml"/>
      </fileset>
    </copy>
 
     <!-- Copy Cocoon configuration and sitemap -->
    <copy todir="${xlayout.build.documentation.dir}" filtering="on">
      <fileset dir="${forrest.cent.dir}/conf"/>
    </copy>

     <!-- Copy Cocoon resources -->
    <copy todir="${xlayout.build.documentation.dir}" filtering="off">
      <fileset dir="${forrest.cent.dir}/resources"/>
    </copy>
    
     <!-- Copy xdocs -->
    <mkdir dir="${xlayout.build.documentation.dir}/content/xdocs"/>
    <copy todir="${xlayout.build.documentation.dir}/content/xdocs" filtering="on">
      <fileset dir="${xlayout.source.documentation.content.xdocs.dir}">
        <exclude name="*.htm*"/>
      </fileset>
    </copy>
    
     <!-- Copy images -->
    <mkdir dir="${xlayout.build.documentation.dir}/resources/images"/>
    <copy todir="${xlayout.build.documentation.dir}/resources/images" filtering="off">
      <fileset dir="${xlayout.source.documentation.resources.images.dir}"/>
    </copy>
               
    <!-- Setup entity catalog and entities -->
    <mkdir dir="${xlayout.build.documentation.dir}/WEB-INF/classes"/>
    <mkdir dir="${xlayout.build.documentation.dir}/WEB-INF/lib"/>
    <move todir="${xlayout.build.documentation.dir}/WEB-INF/classes">
      <fileset dir="${xlayout.build.documentation.dir}/resources/schema">
        <include name="CatalogManager.properties"/>
      </fileset>
    </move>
    
  </target>

  <!-- =================================================================== -->
  <!-- Clean generated docs dir.                                           -->
  <!-- =================================================================== -->
  <target name="cleandocs" description="* Cleans the build docs directories">
    <delete dir="${xlayout.build.documentation.dir}"/>
  </target>


  <target name="making-docs">
    <echo message="-------------------------------------------------------------"/>
    <echo message="  Building docs, please stand by ..."/>
  </target>
  
  <!-- =================================================================== -->
  <!-- The documentation system                                            -->
  <!-- =================================================================== -->
  <target name="owdocs"
          depends="prepare-docs, making-docs"
          description="* Generates the documentation">

    <java classname="org.apache.cocoon.Main" fork="true" dir="${xlayout.build.documentation.dir}" failonerror="true">
      <arg value="-c."/>
      <arg value="-d../docs"/>
      <arg value="-w../work"/>
      <arg value="-l../work/cocoon.log"/>
      <arg value="-uINFO"/>
      <arg value="index.html"/>
      <classpath>
       <fileset dir="." casesensitive="yes"> 
        <patternset>
         <include name="${cents.dir}/*.${cent.dir.suffix}/${cent.lib.dir.name}/*.jar"/>
         <include name="${cents.dir}/*.${cent.dir.suffix}/${cent.lib.dir.name}/*.zip"/>
        </patternset>
       </fileset>  
       <pathelement location="${tools.jar}"/>
       <pathelement location="${xlayout.build.documentation.dir}/WEB-INF/classes"/>
       <fileset dir="${xlayout.build.documentation.dir}/WEB-INF/lib">
         <include name="*.jar"/>
       </fileset>    
     </classpath>
    </java>

    <echo message="  ...docs generated succesfully in ./build/docs ."/>
    <echo message="-------------------------------------------------------------"/>
    
  </target>
  
  <!-- =================================================================== -->
  <!-- The documentation system                                            -->
  <!-- =================================================================== -->
  <target name="docs"
          depends="cleandocs, owdocs"
          description="Cleans docs and generates the documentation">

  </target>
    


</project>  
